Tamsyn Mahoney-Steel took a winding path to Johns Hopkins University in Baltimore.

She began by studying politics and philosophy in her native Britain, then trained as a singer, before getting a doctoral degree in medieval music and literature. Working with centuries-old French lyrics exposed her to systems that help digitally analyze manuscripts, poetry, and literature. In 2013, Mahoney-Steel was hired by Johns Hopkins to use technology to conduct research in medieval studies and to support other researchers, and arrived in the United States on a visa designed for skilled workers, the H-1B. She moved to Baltimore, met the man who would become her husband, and bought a house. All was well—until last year.

Mahoney-Steel’s visa was up for renewal, a process that has traditionally been automatic, and Johns Hopkins gave her the impression that she had no reason to worry. Nine days before her visa was due to expire, however, authorities at the school told her the renewal process was no longer just a formality and that they would not, in fact, seek to extend her H-1B visa. She had to leave the country almost immediately.

“It was a huge shock,” she told me, “and it threw everything off.”

Mahoney-Steel’s case isn’t unique, but it captures the uncertainty of an unwieldy immigration system that successive administrations have failed to reform, and that has become further mired in doubt in the Donald Trump era. The H-1B visa in particular, both its supporters and detractors argue, desperately needs an overhaul. Yet competing interests and disagreement over what needs fixing mean that, even with Trump’s administration having put restricting immigration flows at the center of its agenda, change is far from guaranteed.

Most visitors who come to the United States each year—whether for work, education, or vacation—travel in on a visa, and there are several different categories, each denoting what travelers can and cannot do while in the country and how long they can stay. Visas are just one part of the complex patchwork that makes up the United States’s legal immigration system.

The H-1B is one of several visa categories that allow foreign citizens to work while in the United States. Designed in the early 1990s as a temporary program to fill labor-market needs in highly specialized fields, such visas are issued in low numbers each year: This year’s cap was 85,000 in a nation with a labor force that’s estimated to be about 163 million people.

Yet critics of the H-1B argue that it has become a way for employers to hire cheap foreign labor at the expense of American workers. H-1B holders accounted for about a third of the 1.42 million immigrant workers employed here in fiscal year 2013, according to an analysis published by the Economic Policy Institute, a think tank associated with the labor movement. Many of these immigrants go on to obtain a green card, which allows them to stay in the country permanently.

That is one reason the Trump administration has made the visa the focal point of the president’s “Buy American and Hire American” executive order, which prioritizes U.S. workers and products. The White House has become more selective about approving new H-1B applications and changed the rules governing renewals so that the process is no longer automatic, as in Mahoney-Steel’s case. Though it has also taken other steps such as making it easier for foreign students holding degrees from American universities to get the visa, the administration is gradually making the program a little more restrictive overall. (This appears to have had little impact thus far on the number of people who have applied for H-1Bs—as Bloomberg Law noted, more than 201,000 people put in for the 85,000 visas issued this year, a 6 percent increase over the previous year’s figures.)

The way the visa is used today is far different from how it was envisioned when it was created in the Immigration Act of 1990. That original legislation did two things: It expanded legal immigration by increasing the number of green cards awarded each year, and it updated a 1950s-era program for temporary workers of “distinguished merit and ability” by capping the number who could obtain the visa at 65,000. (The cap has varied over the years.) This new program, the H-1B, was designed for skilled, temporary workers in certain occupations.

“We wrote the H-1B to make it harder and more demanding to use out of the belief that we should admit people as full-fledged Americans compared to people who are here at the sufferance of their employer,” Bruce Morrison, the Democratic chair of a House immigration subcommittee on the Judiciary Committee at the time and the author of the law, told me.

Neither he nor anyone else could have foreseen what came next: the global tech boom and the birth of the outsourcing industry. Suddenly, what had begun as a temporary solution to address a labor shortage became a device through which hundreds of thousands of IT professionals from around the world, especially India, came to the United States. The program became a de facto path to permanent residence and, ultimately, American citizenship. Companies used it to hire workers who, because of the rules of the program, were tied to their employer—they couldn’t negotiate higher wages or move to a company that offered them more money.

The lack of labor mobility became a major criticism of the visa, but it paled in comparison to the program’s impact on American tech workers. Indian companies would win contracts to develop code for American businesses, and would import workers from India to the United States on H-1B visas. Because the number of those who could be brought into the United States was capped, the Indian workers who did obtain the visas would come to the U.S. to be trained before being sent back to India, where they would continue their jobs at lower salaries than their American counterparts commanded. Some American workers even suffered the indignity of being forced to train the H-1B workers who eventually replaced them. Ron Hira, an associate professor of public policy at Howard University in Washington, D.C., who studies the impact of the visa, says the H-1B prioritizes outsourcers, sets wages too low, and doesn’t address the problem it was created to solve—filling labor-market gaps.

“The program has been flawed from the inception,” he told me. “My primary complaint is that it’s used for cheap indentured workers.”

Some of the program’s harshest critics are, in fact, those who have availed of it themselves. Many Indian and Chinese citizens on H-1B visas face years-long waits for permanent residence because of the rules surrounding green cards. They argue that this means they can’t leave their current job, aren’t given raises, and live in limbo, and that the visa should be changed to allow labor mobility.

The visa’s supporters—mainly corporations and immigration lawyers—say that companies sponsor foreign workers not because they’re cheaper, but because they are needed. The application process is expensive, costing upwards of $2,400 (not counting lawyer’s fees), and has become cumbersome, they argue, so no American company would voluntarily seek to hire a foreign worker when simply hiring an American one is far easier. They contend that American universities do churn out graduates in technical STEM subjects, but not at the rate workers are needed.

Previous administrations tried to walk the line between these competing interests, but the Trump administration, through its actions, is making the H-1B far more difficult to get—especially for Indian software companies, whose visa applications were rejected in record numbers last year.

President Trump said in his State of the Union address in February that he wanted “people to come into our country in the largest numbers ever, but they have to come in legally.” On Thursday, he unveiled a plan to prioritize “skilled” migrants over those with family already in the U.S.—one that isn’t expected to garner much support in Congress. But all of the changes so far to the existing system have introduced an atmosphere of uncertainty for people like Mahoney-Steel. Johns Hopkins decided not to seek to renew her visa. She told me that her supervisors were trying to rewrite her job description, but that the position she occupied was deemed by her employers too generic to be a specialized skill. (In an emailed statement, Johns Hopkins said it couldn’t comment in detail on Mahoney-Steel’s case, because of privacy restrictions. It added, however, that it provides immigration advice to “nearly 10,000 international students, staff, faculty, researchers, and their dependents” each year.)

With days left on her visa, Mahoney-Steel had little choice but to pack up and leave. Her American husband has a disability that prevents him from working, and he fell below the income threshold needed to sponsor her for a green card through marriage. The loss of her job had knock-on effects: Her husband lost his health insurance because it had been through her work, they couldn’t pay their mortgage, and they had to cash in her retirement savings. The university paid for her plane ticket and after five years in the United States, she returned, alone, to Britain in September.

In some ways, Mahoney-Steel is among the lucky ones—though she is upset at how quickly she had to leave the country, and about the financial costs of the move, she found a new academic position almost immediately and her husband has since joined her in the United Kingdom.

I asked Mahoney-Steel whether she was surprised at the turn of events. After all, no one expects a British woman with a doctoral degree working in the United States legally for a prestigious employer, not to mention one married to an American citizen, to be asked to suddenly leave the country.

“This just reveals a lot of hypocrisy in the situation,” she said. “People did seem more shocked because I was white and educated. And I wanted to say, ‘No. This is wrong no matter who this is happening to.’”

“There are probably much, much worse stories than mine,” she added, “and they’re not getting heard."