PORTSMOUTH, England—Strongmen, autocrats, and illiberal adversaries of the United States have long had a place in President Donald Trump’s affections. Democratically elected allies: not so much.

Hosting Trump for a state visit that ended Wednesday, Britain used every bit of pageantry and symbolism in its arsenal to impress upon the “America First” president that it’s important to distinguish friend from foe.

Here in the English harbor town of Portsmouth, a jumping-off point for the D-Day landings that will have taken place 75 years ago on Thursday, Trump watched wartime reenactments and a retelling of the Allied invasion that would repel Hitler’s forces and free Europe from Nazi control.

More than a dozen world leaders took part, along with 300 World War II veterans. Trump recited an excerpt from the prayer that President Franklin D. Roosevelt delivered in a radio address to the nation on the eve of the D-Day campaign. Three leaders whom Trump has insulted at different points of his presidency—Theresa May of Britain, Emmanuel Macron of France, and Justin Trudeau of Canada—read letters from soldiers who fought alongside the United States.

May recited a letter from Captain Norman Skinner, a British soldier, to his wife: “There is so much that I would like to be able to tell you—nearly all of which you’ve heard many, many times but just to say that I mean it even more today. I’m sure that I will be with you again soon and for good.” Skinner had carried the letter in his pocket as he landed on Sword Beach and later died.

Queen Elizabeth II, whose own wartime duties involved joining the Women’s Auxiliary Territorial Service, spoke with the veterans in attendance. “When I attended the commemoration of the 60th anniversary of the D-Day landings, some thought it might be the last such event,” the Queen said. “But the wartime generation—my generation—is resilient … It is with humility and pleasure on behalf of the entire country—indeed, the whole free world—that I say to you all: Thank you.”

It’s difficult to know what sort of impression the scene will have made on Trump. Yet as is often the case when this president travels overseas, his attentions were divided.

In the hours ahead of the visit to Portsmouth, he tweeted scornfully about a potential rival in the 2020 presidential race, former Vice President Joe Biden, and targeted the actor Bette Midler for sharing a quote that Trump had never actually said. He called Midler a “washed-up psycho” and a “sick scammer.” But he also embraced the courtesies that Britain extended. He praised the partnership between the United States and the United Kingdom as “the greatest alliance the world has ever known” and fawned over the Queen. “Great woman, great woman,” Trump told the press pool as he said goodbye to his hosts here.

He is due to take part in another D-Day ceremony at Normandy on Thursday—a second opportunity for European counterparts to show Trump that the alliance is worth preserving, to urge him to rethink his practice of pushing away long-standing friends and courting authoritarians.

“Almost everyone in the world who is an ally of the United States is worrying, because you don’t know when push comes to shove that he’s going to come to help,” says Kathleen Burk, a specialist in Anglo-American relations at University College London. “The British idea was to remind him that we’re better united than divided. If you want to land in Europe, you need Britain. I hope he’s taken away the shared values and the shared necessity of banning together.”

Back home, some lawmakers have been baffled by Trump’s approach toward diplomacy. He has faulted NATO allies for not ponying up more money for their own defense. At the same time, he has gushed over leaders who have curbed or banned basic freedoms that were at stake in the D-Day invasion he is now celebrating.

Last month at the White House, Trump hosted Hungarian Prime Minister Viktor Orbán and praised him for having done “a tremendous job in so many different ways.” Orbán’s government has been criticized across Europe for its crackdown on Hungary’s universities, part of a broader effort to do away with the country’s liberal intellectual elite. “Highly respected. Respected all over Europe,” Trump said of his guest at the time.

Trump has said he “fell in love” with the North Korean dictator Kim Jong Un. It’s a romance that seems unrequited; Kim is resisting the president’s efforts to abandon the country’s nuclear program. Then there is Russian President Vladimir Putin, whom Trump has been famously reluctant to confront over Russian interference in U.S. elections.

Trump “conducts himself differently when he’s with authoritarian leaders who are not our allies than when he’s with democratically elected leaders who are our allies,” Senator Chris Coons, a Democrat who serves on the Foreign Relations Committee, said in an interview.

“He celebrates and lauds authoritarian leaders with very bad human rights records and little respect for democracy, and he challenges and pushes and tests the patience of our most reliable allies with whom we share core values.”

Playing to his vanity, Trump’s British hosts sought to bring him back into the fold. The Queen made him only the third U.S. president to receive a state dinner, after his two predecessors in the Oval Office. The royal family fussed over the president’s adult children, who accompanied their father on the trip and attended the banquet Monday night at Buckingham Palace and the joint May-Trump news conference on Tuesday.

Throughout the stay, Trump’s British hosts turned his attention to Winston Churchill, the wartime prime minister who worked to cement the alliance that was crucial to defeating Hitler. The Queen gave Trump a first edition of Churchill’s account of World War II. The president also got a private tour of the Churchill War Rooms, the mazelike bunker beneath the streets of Westminster where the prime minister ran the war effort. Trump’s children came along. “Unbelievable,” was the verdict from Eric Trump.

European allies may still believe they have more convincing to do. Later in the day, Trump flew to Ireland, where he met with Prime Minister Leo Varadkar at the airport in Shannon. Discussing the contentious issue of the Irish border, which looms over Brexit, Trump told Varadkar: “I think it will all work out very well, and also for you with your wall, your border.”

Varadkar’s reply: “I think one thing we want to avoid, of course, is a wall or border between us.”